<!DOCTYPE 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Domino Scoreboard</title>
  <style>
    /* Reset */
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body, html {
      width: 100%;
      height: 100%;
      font-family: Arial, sans-serif;
      transition: background-color 0.3s, color 0.3s;
      background-color: #eee;
      color: #111;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    body.dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }

    /* Home Screen */
    .home {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      gap: 15px;
      padding: 10px;
      background-color: inherit;
      user-select: text;
    }

    .home input, .home select {
      width: 220px;
      max-width: 90vw;
      padding: 8px 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      user-select: text;
      transition: border-color 0.3s;
    }

    body.dark-mode .home input,
    body.dark-mode .home select {
      background: #222;
      border-color: #555;
      color: #eee;
    }

    .home input::placeholder {
      color: #888;
    }

    body.dark-mode .home input::placeholder {
      color: #bbb;
    }

    .home button {
      padding: 12px 28px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background-color: #007acc;
      color: white;
      user-select: none;
      transition: background-color 0.3s ease;
      min-width: 140px;
    }

    .home button:hover,
    .home button:focus {
      background-color: #005f99;
      outline: none;
    }

    /* Scoreboard */
    #game.scoreboard {
      display: flex;
      width: 100vw;
      height: 100vh;
      flex-wrap: nowrap;
      user-select: none;
    }

    /* Solo mode: horizontal layout */
    #game.solo {
      flex-direction: row;
    }

    #game.solo #player1 {
      background-color: #2b6777;
      color: white;
      border-right: 2px solid white;
    }

    #game.solo #player2 {
      background-color: #c8d8e4;
      color: black;
    }

    /* Duel mode: vertical stacked layout */
    #game.duel {
      flex-direction: column;
    }

    #game.duel #player1 {
      background-color: #ffcccb;
      color: black;
      border-bottom: 2px solid white;
      transform: rotate(180deg);
      /* Make text inside not rotated */
    }

    #game.duel #player1 .name,
    #game.duel #player1 .score,
    #game.duel #player1 .undo {
      transform: rotate(180deg);
      user-select: none;
    }

    #game.duel #player2 {
      background-color: #90ee90;
      color: black;
    }

    /* Player area */
    .player {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
      cursor: pointer;
      transition: background-color 0.2s ease;
      user-select: none;
    }

    .player:active {
      filter: brightness(0.85);
    }

    .name {
      font-size: 20px;
      margin-bottom: 10px;
      user-select: text;
    }

    .score {
      font-size: 60px;
      font-weight: bold;
      margin: 10px 0;
    }

    .undo {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #444;
      color: white;
      cursor: pointer;
      position: absolute;
      bottom: 20px;
      user-select: none;
      transition: background-color 0.3s ease;
    }

    .undo:hover,
    .undo:focus {
      background-color: #222;
      outline: none;
    }

    body.dark-mode #game.solo #player1 {
      background-color: #1e4e5f;
      border-color: #ccc;
      color: #ddd;
    }

    body.dark-mode #game.solo #player2 {
      background-color: #334c58;
      color: #ccc;
    }

    body.dark-mode #game.duel #player1 {
      background-color: #803333;
      border-color: #ccc;
      color: #eee;
    }

    body.dark-mode #game.duel #player2 {
      background-color: #3a8a3a;
      color: #ddd;
    }

    /* Modal (Winner) */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal.hidden {
      display: none;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 8px;
      font-size: 24px;
      font-weight: 700;
      color: #007acc;
      text-align: center;
      box-shadow: 0 0 15px #007accaa;
      max-width: 90vw;
      user-select: text;
    }

    body.dark-mode .modal-content {
      background: #222;
      color: #aaddff;
      box-shadow: 0 0 15px #66aaffaa;
    }

    .modal-content button {
      margin: 15px 10px 0 10px;
      padding: 10px 25px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background-color: #007acc;
      color: white;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    .modal-content button:hover,
    .modal-content button:focus {
      background-color: #005f99;
      outline: none;
    }

    /* Settings Panel */
    .settings-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 80%;
      max-width: 320px;
      height: 100vh;
      background-color: #fff;
      border-left: 1px solid #ccc;
      box-shadow: -2px 0 6px rgba(0, 0, 0, 0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      padding: 20px;
      overflow-y: auto;
      z-index: 10001;
      user-select: text;
    }

    body.dark-mode .settings-panel {
      background-color: #222;
      color: #eee;
      border-color: #444;
    }

    .settings-panel.open {
      transform: translateX(0);
    }

    .settings-panel h2 {
      margin-top: 0;
      margin-bottom: 15px;
      user-select: text;
    }

    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }

    body.dark-mode .settings-option {
      border-color: #555;
    }

    .settings-option button,
    .settings-option select {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      user-select: none;
    }

    body.dark-mode .settings-option button,
    body.dark-mode .settings-option select {
      background: #444;
      color: #fff;
    }

.settings-toggle {
  position: fixed;
  top: 15px;
  right: 15px;
  z-index: 10002;
  background: transparent;
  border: none;
  font-size: 22px;
  padding: 10px 14px;
  color: inherit;
  cursor: pointer;
  user-select: none;
  transition: none;
}

/* Remove hover/focus effects completely */
.settings-toggle:hover,
.settings-toggle:focus {
  background: transparent;
  outline: none;
  box-shadow: none;
}


    /* History Button */
    #historyBtn {
      font-size: 28px;
      color: gold;
      background: transparent;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      user-select: none;
      transition: transform 0.2s ease;
    }

    #historyBtn:hover, #historyBtn:focus {
      transform: scale(1.1);
      outline: none;
    }
/* History Panel */
#historyPanel {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 350px;
  max-height: 80vh;
  background: #fff;
  border: 2px solid #007acc;
  border-radius: 10px;
  box-shadow: 0 0 15px #007accaa;
  overflow-y: auto;
  padding: 15px;
  z-index: 10000;
  font-size: 14px;
  transform: translate(-50%, -50%);
  user-select: text;
}

body.dark-mode #historyPanel {
  background: #222;
  border-color: #66aaff;
  color: #eee;
  box-shadow: 0 0 15px #66aaffaa;
}

/* History Panel */
#historyPanel {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 350px;
  max-height: 80vh;
  background: #fff;
  border: 2px solid #007acc;
  border-radius: 10px;
  box-shadow: 0 0 15px #007accaa;
  overflow-y: auto;
  padding: 15px;
  z-index: 10000;
  font-size: 14px;
  transform: translate(-50%, -50%);
  user-select: text;
  color: #222; /* default dark text */
}

body.dark-mode #historyPanel {
  background: #121212;
  border-color: #3399ff;
  box-shadow: 0 0 15px #3399ffaa;
  color: #ddd; /* default light text */
}

#historyPanel h3 {
  margin-bottom: 10px;
  color: #007acc;
  text-align: center;
  user-select: text;
}

body.dark-mode #historyPanel h3 {
  color: #66aaff;
}

#historyPanel select {
  display: block;
  margin: 0 auto 10px auto;
  padding: 5px;
  font-size: 16px;
  border-radius: 6px;
  border: 1.5px solid #007acc;
  width: 180px;
  max-width: 90vw;
  cursor: pointer;
  user-select: none;
  background: white;
  color: #111;
  transition: background-color 0.3s, color 0.3s;
}

body.dark-mode #historyPanel select {
  background: #222;
  border-color: #66aaff;
  color: #eee;
}

#historyPanel table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

#historyPanel th,
#historyPanel td {
  padding: 5px;
  border-bottom: 1px solid #ddd;
  text-align: left;
  color: inherit; /* inherit from parent */
}

body.dark-mode #historyPanel th,
body.dark-mode #historyPanel td {
  border-color: #444;
}

/* Alternate row background colors */
#historyPanel tr:nth-child(even) {
  background-color: #f9f9f9;
}

body.dark-mode #historyPanel tr:nth-child(even) {
  background-color: #2a2a2a;
}

#historyPanel tr:nth-child(odd) {
  background-color: #fff;
}

body.dark-mode #historyPanel tr:nth-child(odd) {
  background-color: #1b1b1b;
}

/* WINNER row styles */
#historyPanel tr.winner {
  background-color: #2a9d8f !important; /* teal green */
  color: #ffffff !important; /* white text */
  font-weight: 700;
}

body.dark-mode #historyPanel tr.winner {
  background-color: #1f6f63 !important; /* darker teal */
  color: #ffffff !important;
  font-weight: 700;
}

/* LOSER row styles */
#historyPanel tr.loser {
  background-color: #e76f51 !important; /* warm coral/orange */
  color: #ffffff !important; /* white text */
  font-weight: 700;
}

body.dark-mode #historyPanel tr.loser {
  background-color: #b54a36 !important; /* darker coral */
  color: #ffffff !important;
  font-weight: 700;
}

/* Close button */
#closeHistoryBtn {
  display: block;
  margin: 10px auto 0 auto;
  padding: 8px 16px;
  font-size: 16px;
  border-radius: 8px;
  background-color: #007acc;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
}

#closeHistoryBtn:hover,
#closeHistoryBtn:focus {
  background-color: #005f99;
  outline: none;
}

/* Accessibility & focus styles */
button:focus,
input:focus,
select:focus {
  outline: 2px solid #007acc;
  outline-offset: 2px;
}

/* Scrollbar for history panel */
#historyPanel::-webkit-scrollbar {
  width: 8px;
}
#historyPanel::-webkit-scrollbar-thumb {
  background: #007acc;
  border-radius: 4px;
}
body.dark-mode #historyPanel::-webkit-scrollbar-thumb {
  background: #66aaff;
}

/* Hide elements */
.hidden {
  display: none !important;
}p

/* Close button */
#closeHistoryBtn {
  display: block;
  margin: 10px auto 0 auto;
  padding: 8px 16px;
  font-size: 16px;
  border-radius: 8px;
  background-color: #007acc;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
}

#closeHistoryBtn:hover,
#closeHistoryBtn:focus {
  background-color: #005f99;
  outline: none;
}

/* Accessibility & focus styles */
button:focus,
input:focus,
select:focus {
  outline: 2px solid #007acc;
  outline-offset: 2px;
}

/* Scrollbar for history panel */
#historyPanel::-webkit-scrollbar {
  width: 8px;
}

#historyPanel::-webkit-scrollbar-thumb {
  background: #007acc;
  border-radius: 4px;
}

body.dark-mode #historyPanel::-webkit-scrollbar-thumb {
  background: #66aaff;
}

/* Hide elements */
.hidden {
  display: none !important;
}
  </style>
</head>
<body>

  <!-- Settings toggle button -->
  <button class="settings-toggle" aria-label="Open settings" title="Settings" onclick="toggleSettings()">‚öôÔ∏è</button>

  <!-- Settings panel -->
  <aside class="settings-panel" id="settingsPanel" role="region" aria-label="Settings Panel">
    <h2>Settings</h2>

    <div class="settings-option">
      <label for="darkModeToggle">Dark Mode</label>
      <button id="darkModeToggle" onclick="toggleDarkMode()" aria-pressed="false" aria-label="Toggle dark mode">üåô</button>
    </div>

    <div class="settings-option">
      <label for="resetScoresBtn">Reset Scores</label>
      <button id="resetScoresBtn" onclick="resetScores()">Reset</button>
    </div>

    <div class="settings-option">
      <label for="exitToHomeBtn">Exit to Home</label>
      <button id="exitToHomeBtn" onclick="exitToHome()">Exit</button>
    </div>

    <div class="settings-option">
      <label for="scoreIncrementSelect">Score Tap Amount</label>
      <select id="scoreIncrementSelect" aria-label="Select score tap increment">
        <option value="1">1</option>
        <option value="3">3</option>
        <option value="5" selected>5</option>
      </select>
    </div>

    <div class="settings-option">
      <label>Player Colors</label>
      <button disabled>Coming Soon</button>
    </div>

    <div class="settings-option">
      <label>Sound Effects</label>
      <button disabled>Coming Soon</button>
    </div>

    <div class="settings-option">
      <label>Accessibility Options</label>
      <button disabled>Coming Soon</button>
    </div>
  </aside>

  <!-- Home Screen -->
  <main class="home" id="home" role="main" aria-label="Domino scoreboard home screen">
    <h1>Domino Scoreboard</h1>
    <input id="name1" placeholder="Player A Name" aria-label="Player A name" />
    <input id="name2" placeholder="Player B / Deck Name" aria-label="Player B or Deck name" />
    <input id="target1" type="number" placeholder="Player A Target (default 300)" aria-label="Player A target score" />
    <input id="target2" type="number" placeholder="Player B / Deck Target (default 300/350)" aria-label="Player B or Deck target score" />
    <select id="increment" aria-label="Score increment">
      <option value="5" selected>+5 per tap</option>
      <option value="3">+3 per tap</option>
      <option value="1">+1 per tap</option>
    </select>
    <button onclick="startGame('solo')" aria-label="Start solo play game">Solo Play</button>
    <button onclick="startGame('duel')" aria-label="Start duel play game">Duel Play</button>
    <button id="historyBtn" aria-label="Show game history" title="Game History">üèÜ History</button>
  </main>

  <!-- Game Screen -->
  <section id="game" class="scoreboard hidden" role="region" aria-label="Domino scoreboard game screen" aria-live="polite">
    <div id="player1" class="player" onclick="addScore('player1')" tabindex="0" role="button" aria-label="Player 1 score area. Tap to add score.">
      <div class="name" id="nameDisplay1">Player A</div>
      <div class="score" id="score1">0</div>
      <button class="undo" onclick="event.stopPropagation(); undo('player1')" aria-label="Undo Player 1 last score">Undo</button>
    </div>
    <div id="player2" class="player" onclick="addScore('player2')" tabindex="0" role="button" aria-label="Player 2 score area. Tap to add score.">
      <div class="name" id="nameDisplay2">Player B</div>
      <div class="score" id="score2">0</div>
      <button class="undo" onclick="event.stopPropagation(); undo('player2')" aria-label="Undo Player 2 last score">Undo</button>
    </div>
  </section>

  <!-- Modal for Winner -->
  <div id="modal" class="modal hidden" role="alertdialog" aria-modal="true" aria-live="assertive" aria-labelledby="modalTitle">
    <div class="modal-content" id="modalContent">
      <div id="modalTitle" style="margin-bottom: 10px; font-weight: 700;">Winner!</div>
      <div>
        <button id="playAgainBtn" aria-label="Play again with same settings">Play Again</button>
        <button id="closeModalBtn" aria-label="Close winner dialog and go home">Close</button>
      </div>
    </div>
  </div>

  <!-- History Panel -->
  <aside id="historyPanel" class="hidden" aria-label="Game history panel" role="region" aria-live="polite">
    <h3>Game History</h3>
    <select id="historyFilterSelect" aria-label="Filter game history">
      <option value="all">All</option>
      <option value="solo">Solo</option>
      <option value="duel">Duel</option>
    </select>
    <div id="historyList"></div>
    <button id="closeHistoryBtn">Close</button>
  </aside>

  <script>
    // Scores and game state
    let scores = { player1: 0, player2: 0 };
    let history = { player1: [], player2: [] };
    let targets = { player1: 300, player2: 300 };
    let increment = 5;
    let currentMode = null;
    let currentSettings = {};
    let darkModeEnabled = false;

    // Start game function
    function startGame(mode) {
      currentMode = mode;

      currentSettings = {
        name1: document.getElementById("name1").value.trim() || "Player A",
        name2: document.getElementById("name2").value.trim() || (mode === "solo" ? "Deck" : "Player B"),
        target1: parseInt(document.getElementById("target1").value, 10) || 300,
        target2: parseInt(document.getElementById("target2").value, 10) || (mode === "solo" ? 350 : 300),
        increment: parseInt(document.getElementById("increment").value, 10)
      };

      increment = currentSettings.increment;
      targets.player1 = currentSettings.target1;
      targets.player2 = currentSettings.target2;

      document.getElementById("nameDisplay1").textContent = currentSettings.name1;
      document.getElementById("nameDisplay2").textContent = currentSettings.name2;

      document.getElementById("home").classList.add("hidden");

      const gameDiv = document.getElementById("game");
      gameDiv.classList.remove("solo", "duel");
      gameDiv.classList.add(mode);
      gameDiv.classList.remove("hidden");

      // Reset scores and history arrays for undo
      scores = { player1: 0, player2: 0 };
      history = { player1: [], player2: [] };
      updateScores();

      // Sync increment selector in settings with chosen increment
      document.getElementById('scoreIncrementSelect').value = increment.toString();

      // Hide other panels
      hideHistoryPanel();
      hideSettings();
    }

    // Add score when player area tapped
    function addScore(player) {
      scores[player] += increment;
      history[player].push(increment);
      updateScores();
      checkWin();
      if (navigator.vibrate) navigator.vibrate(50);
    }

    // Undo last score increment for a player
    function undo(player) {
      if (history[player].length > 0) {
        const last = history[player].pop();
        scores[player] -= last;
        updateScores();
      }
    }

    // Update displayed scores
    function updateScores() {
      document.getElementById("score1").textContent = scores.player1;
      document.getElementById("score2").textContent = scores.player2;
    }

    // Check if someone reached target to win
    function checkWin() {
      if (scores.player1 >= targets.player1) {
        endGame(currentSettings.name1, scores.player1, currentSettings.name2, scores.player2, currentMode);
      } else if (scores.player2 >= targets.player2) {
        endGame(currentSettings.name2, scores.player2, currentSettings.name1, scores.player1, currentMode);
      }
    }

    // End game: show winner modal and save game history
    function endGame(winnerName, winnerScore, loserName, loserScore, mode) {
      saveGameToHistory({
        mode: mode,
        name1: currentSettings.name1,
        score1: scores.player1,
        name2: currentSettings.name2,
        score2: scores.player2,
        winner: winnerName
      });

      const modal = document.getElementById("modal");
      document.getElementById("modalTitle").textContent = `${winnerName} Wins!`;
      modal.classList.remove("hidden");
    }

    // Save completed game to localStorage history
    function saveGameToHistory(game) {
      let allHistory = JSON.parse(localStorage.getItem('dominoHistory')) || [];
      allHistory.push(game);
      if (allHistory.length > 20) {
        allHistory.shift(); // keep last 20
      }
      localStorage.setItem('dominoHistory', JSON.stringify(allHistory));
    }

    // Modal buttons handlers
    document.getElementById("playAgainBtn").addEventListener("click", () => {
      hideModal();
      startGame(currentMode);
    });

    document.getElementById("closeModalBtn").addEventListener("click", () => {
      hideModal();
      exitToHome();
    });

    function hideModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    // Exit to home screen
    function exitToHome() {
      document.getElementById("game").classList.add("hidden");
      document.getElementById("home").classList.remove("hidden");
      hideHistoryPanel();
      hideSettings();
    }

    // History panel elements
    const historyBtn = document.getElementById('historyBtn');
    const historyPanel = document.getElementById('historyPanel');
    const historyList = document.getElementById('historyList');
    const closeHistoryBtn = document.getElementById('closeHistoryBtn');
    const historyFilterSelect = document.getElementById('historyFilterSelect');

    historyBtn.addEventListener('click', () => {
      renderHistory('all');
      historyPanel.classList.remove('hidden');
      hideSettings();
    });

    closeHistoryBtn.addEventListener('click', () => {
      hideHistoryPanel();
    });

    historyFilterSelect.addEventListener('change', () => {
      renderHistory(historyFilterSelect.value);
    });

    function hideHistoryPanel() {
      historyPanel.classList.add('hidden');
    }

    // Render history table with optional filter
    function renderHistory(filter = 'all') {
      const allHistory = JSON.parse(localStorage.getItem('dominoHistory')) || [];
      let filteredHistory = allHistory;

      if (filter === 'solo' || filter === 'duel') {
        filteredHistory = allHistory.filter(h => h.mode === filter);
      }

      if (filteredHistory.length === 0) {
        historyList.innerHTML = '<p style="text-align:center; margin-top:10px;">No games played yet.</p>';
        return;
      }

      let html = '<table><thead><tr><th>Mode</th><th>Player A</th><th>Score</th><th>Player B / Deck</th><th>Score</th><th>Winner</th></tr></thead><tbody>';

      // Show last 20 games newest first
      filteredHistory.slice(-20).reverse().forEach(game => {
        const winnerA = game.score1 > game.score2;
        const winnerB = game.score2 > game.score1;
        const tie = !winnerA && !winnerB;

        let rowClass = '';
        if (winnerA) rowClass = 'winner';
        else if (winnerB) rowClass = 'loser';

        html += `
          <tr class="${rowClass}">
            <td>${capitalize(game.mode)}</td>
            <td>${escapeHtml(game.name1)}</td>
            <td>${game.score1}</td>
            <td>${escapeHtml(game.name2)}</td>
            <td>${game.score2}</td>
            <td style="font-weight: 700; color: ${winnerA ? '#155724' : winnerB ? '#721c24' : '#6c757d'};">
              ${tie ? 'Tie' : winnerA ? escapeHtml(game.name1) : escapeHtml(game.name2)}
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      historyList.innerHTML = html;
    }

    // Escape HTML to prevent XSS from user input in names
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function(m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    // Capitalize first letter helper
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Settings panel toggle
    const settingsPanel = document.getElementById('settingsPanel');
    const settingsToggleBtn = document.querySelector('.settings-toggle');

    function toggleSettings() {
      if (settingsPanel.classList.contains('open')) {
        hideSettings();
      } else {
        showSettings();
      }
    }

    function showSettings() {
      settingsPanel.classList.add('open');
      historyPanel.classList.add('hidden');
    }

    function hideSettings() {
      settingsPanel.classList.remove('open');
    }

    // Dark mode toggle button
    const darkModeBtn = document.getElementById('darkModeToggle');

    function toggleDarkMode() {
      darkModeEnabled = !darkModeEnabled;
      if (darkModeEnabled) {
        document.body.classList.add('dark-mode');
        darkModeBtn.setAttribute('aria-pressed', 'true');
        darkModeBtn.textContent = 'üåû';
      } else {
        document.body.classList.remove('dark-mode');
        darkModeBtn.setAttribute('aria-pressed', 'false');
        darkModeBtn.textContent = 'üåô';
      }
      // Save preference
      localStorage.setItem('dominoDarkMode', darkModeEnabled ? '1' : '0');
    }

    // Load dark mode preference on startup
    window.addEventListener('load', () => {
      if (localStorage.getItem('dominoDarkMode') === '1') {
        darkModeEnabled = false; // so toggle flips it on
        toggleDarkMode();
      }

      // Load increment from settings into home screen
      const savedIncrement = localStorage.getItem('dominoScoreIncrement');
      if (savedIncrement) {
        document.getElementById('scoreIncrementSelect').value = savedIncrement;
        document.getElementById('increment').value = savedIncrement;
        increment = parseInt(savedIncrement, 10);
      }
    });

    // Sync increment selector in settings and home screen inputs
    const scoreIncrementSelect = document.getElementById('scoreIncrementSelect');
    const homeIncrementSelect = document.getElementById('increment');

    scoreIncrementSelect.addEventListener('change', () => {
      increment = parseInt(scoreIncrementSelect.value, 10);
      homeIncrementSelect.value = increment;
      localStorage.setItem('dominoScoreIncrement', increment.toString());
    });

    homeIncrementSelect.addEventListener('change', () => {
      increment = parseInt(homeIncrementSelect.value, 10);
      scoreIncrementSelect.value = increment;
      localStorage.setItem('dominoScoreIncrement', increment.toString());
    });

    // Reset scores action (doesn't exit game, just resets scores and undo history)
    function resetScores() {
      scores = { player1: 0, player2: 0 };
      history = { player1: [], player2: [] };
      updateScores();
      hideModal();
    }

    // Accessibility: keyboard support for player score buttons
    document.getElementById('player1').addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        addScore('player1');
      }
    });

    document.getElementById('player2').addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        addScore('player2');
      }
    });

  </script>
</body>
</html>